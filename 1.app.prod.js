(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{554:function(e,t,r){"use strict";r.r(t);var i=r(243);var o=function(e){if(!Array.isArray(e))throw new TypeError("Middleware stack must be an array!");for(const t of e)if("function"!=typeof t.match||"function"!=typeof t.resolve)throw new TypeError("Middleware must be composed of functions!");return function(t){let r=-1;return function i(o){if(o<=r)return Promise.reject(new Error("next() called multiple times"));r=o;let a=e[o];if(!a)return Promise.resolve();if(!a.match(t.req.url,t))return Promise.resolve(i(o+1));try{return Promise.resolve(a.resolve(t,function(){return i(o+1)}))}catch(e){return Promise.reject(e)}}(0)}},a=r(629),l=r(106);const n=new Set(["user-agent","referer"]),s=e=>("object"==typeof e&&(e={...e},Object.keys(e).forEach(t=>{n.has(t.toLowerCase())&&(e[`X-Metastream-${t}`]=e[t])})),e);let p=0;const d=(e,t={})=>new Promise((r,i)=>{e.startsWith("//")&&(e=`https:${e}`);try{new URL(e)}catch(e){return void i(e)}t={credentials:"omit",...t,headers:s(t.headers)};const o=p++,a=e=>{const{data:t}=e;if("object"!=typeof t)return;if(t.type!==`metastream-fetch-response${o}`)return;window.removeEventListener("message",a,!1);const{err:l,resp:n}=t.payload;l?i(l):r(n)};window.addEventListener("message",a,!1),window.postMessage({type:"metastream-fetch",payload:{requestId:o,url:e,options:t}},location.origin)}),m=async(e,t)=>{const r=await d(e,t);return[r.body,r]};var u=r(122);const g=/reddit\.com\/r\/([^\s\/]+)\/?/i,c=({data:e})=>{let t={id:e.id,url:e.url,title:`${e.title} - /r/${e.subreddit}`};const r=e.crosspost_parent_list;if(e.media&&(t.media=e.media),r&&r.length>0){const e=r[0];e.url&&(t.url=e.url),e.media&&(t.media=e.media)}return t},h=async(e,t)=>{const r=Object(a.parse)(e,!0),i={...r.query,limit:5};t&&(i.after=t);const o=Object(l.a)(i),n=`${r.protocol}//${r.hostname}${r.pathname}.json?${o}`,[s]=await m(n,{headers:{Referer:u.b}});return s},f=e=>{return e.data.children.filter(e=>!e.data.stickied).map(c)};var y={match(e,t){const r=!!g.exec(e.href),i=!!e.pathname&&e.pathname.includes("/comments/");return r&&!i||!(!t.req.state||!t.req.state.reddit)},async resolve(e,t){const r=e.req.state;let i,o,a,l;if(r&&r.reddit)i=r.reddit.href,o=r.reddit.children,a=r.reddit.after,l=r.reddit.idx;else{i=e.req.url.href;const r=await h(i);if(console.log("Subreddit JSON",r),r.error)return console.debug("Error fetching subreddit posts"),t();const n=f(r);if(0===n.length)return t();o=n,a=r.data.after,l=-1}let n=l+1,s=o[n];if(!s){const e=await h(r.reddit.href,r.reddit.after),i=f(e);if(0===i.length)return t();if(s=(o=i)[n=0],a=e.data.after,!s)return}if(e.res.type="playlist",e.res.hasMore=!0,e.res.state={...e.res.state,reddit:{...(r||{}).reddit,href:i,idx:n,children:o,after:a}},!((e,t)=>{e.res.title=t.title;const r=new URL(t.url);r&&r.href&&(e.req.url=r);const{media:i}=t;if(i){if(i.reddit_video){const t=i.reddit_video;return e.res.url=t.fallback_url,e.res.duration=t.duration,!0}if(i.oembed)return!1}return!1})(e,s)){await t();let r=s.title||e.res.title;return e.res.title=r,e.res}}},w=r(95);const I=/youtu\.?be(?:.com)?/i,b=[/youtu\.be\/([^#\&\?]{11})/,/\?v=([^#\&\?]{11})/,/\&v=([^#\&\?]{11})/,/embed\/([^#\&\?]{11})/,/\/v\/([^#\&\?]{11})/];class v{static getInstance(){return this.instance||(this.instance=new v),this.instance}getVideoId(e){let t;for(let r=0;r<b.length&&!(t=b[r].exec(e));r++);return t?t[1]:null}}var N={match(e){const{hostname:t="",href:r=""}=e;return!!I.exec(t)&&!!v.getInstance().getVideoId(r)},async resolve(e,t){let r;try{r=await async function(e,t){const r=t("meta[itemprop=duration]").attr("content"),i=t("meta[itemprop=isLiveBroadcast]"),o=t("meta[itemprop=endDate]");let a;a="true"!==(i.attr("content")||"").toLowerCase()||o?r?1e3*Object(w.f)(r):void 0:0;const l=t("#eow-description"),n=1===l.length?Object(w.e)(l):void 0;return e.searchParams.has("t"),{duration:a,description:n}}(e.req.url,e.state.$)}catch(e){return console.error("YouTube request failed",e.message),t()}return Object(w.b)(e.res,r),e.res.state.referrer=!0,e.state.oEmbed=!1,t()}};const P=/youtu\.?be(?:.com)?/i;var V={match(e,t){const r=!!P.exec(e.href),i=e.searchParams.has("list");return r&&i||Boolean(t.req.state&&t.req.state.ytpl)},async resolve(e,t){const{state:r}=e.req,i=r&&r.ytpl||{};if(void 0===i.index){await t();const{res:r}=e,{body:o,$:a}=e.state;if(!o||!a)return;const l=a(".playlist-title").text()||r.title;i.title=(l||"YouTube Playlist").trim();const n=a("#playlist-length").text().split(" ")[0],s=parseInt(n,10);if(isNaN(s))return;i.length=s;const p=a("li.currently-playing").data("index"),d=e.req.url.searchParams,m=p||d.get("index")||"0";i.index=parseInt(m,10)||0,e.res.state.ytpl=i}else{i.index++;const t=e.req.url;t.pathname="/embed/videoseries",t.searchParams.set("index",`${i.index}`),e.res.url=t.toString()}let{index:o,length:a,title:l}=i;return e.res.title=l,e.res.state={...e.req.state,ytpl:i,referrer:!0},e.res.hasMore=o<a-1,e.res}};var j={match:({protocol:e})=>"http:"===e||"https:"===e,async resolve(e,t){const{url:r}=e.req,i=await(async(e,t)=>{return await d(e,t)})(r.href,{method:"HEAD",headers:{"user-agent":u.d,referer:r.href}}),o=i.status||200;let a=i.headers["content-type"];const l=(e=>e?(e.split("/").shift()||"").toLowerCase():"")(a=Array.isArray(a)?a[0]:a);return e.state.responseCode=o,e.state.contentType=a,e.state.type=l,t()}},x=r(83);const O=new Set(["audio","image","video"]);var W={match:({protocol:e})=>"http:"===e||"https:"===e,resolve({req:e,res:t,state:r},i){const{url:o}=e,{type:a}=r;if(a&&O.has(a)){const e=function(e){return{url:e.href,title:Object(x.basename)(e.pathname||e.href)}}(o);return t.url=e.url||t.url,t.title=t.title||e.title,t}return i()}},A=r(580);var S={match:({protocol:e})=>"http:"===e||"https:"===e,async resolve(e,t){const{url:r}=e.req,[i,o]=await m(r.href,{headers:{"user-agent":u.d,host:r.host}});e.state.body=i;const a=e.state.$=Object(A.load)(i);return e.res.title=a("title").text().trim()||e.res.title,t()}},q=r(866);const H=[{multiple:!1,property:"og:title",fieldName:"ogTitle"},{multiple:!1,property:"og:type",fieldName:"ogType"},{multiple:!0,property:"og:image",fieldName:"ogImage"},{multiple:!0,property:"og:image:url",fieldName:"ogImageURL"},{multiple:!0,property:"og:image:secure_url",fieldName:"ogImageSecureURL"},{multiple:!0,property:"og:image:width",fieldName:"ogImageWidth"},{multiple:!0,property:"og:image:height",fieldName:"ogImageHeight"},{multiple:!0,property:"og:image:type",fieldName:"ogImageType"},{multiple:!1,property:"og:url",fieldName:"ogUrl"},{multiple:!1,property:"og:audio",fieldName:"ogAudio"},{multiple:!1,property:"og:audio:url",fieldName:"ogAudioURL"},{multiple:!1,property:"og:audio:secure_url",fieldName:"ogAudioSecureURL"},{multiple:!1,property:"og:audio:type",fieldName:"ogAudioType"},{multiple:!1,property:"og:description",fieldName:"ogDescription"},{multiple:!1,property:"og:determiner",fieldName:"ogDeterminer"},{multiple:!1,property:"og:locale",fieldName:"ogLocale"},{multiple:!1,property:"og:locale:alternate",fieldName:"ogLocaleAlternate"},{multiple:!1,property:"og:site_name",fieldName:"ogSiteName"},{multiple:!0,property:"og:video",fieldName:"ogVideo"},{multiple:!0,property:"og:video:url",fieldName:"ogVideo"},{multiple:!0,property:"og:video:secure_url",fieldName:"ogVideoSecureURL"},{multiple:!0,property:"og:video:width",fieldName:"ogVideoWidth"},{multiple:!0,property:"og:video:height",fieldName:"ogVideoHeight"},{multiple:!0,property:"og:video:type",fieldName:"ogVideoType"},{multiple:!0,property:"og:video:duration",fieldName:"ogVideoDuration"},{multiple:!0,property:"video:duration",fieldName:"videoDuration"},{multiple:!1,property:"twitter:card",fieldName:"twitterCard"},{multiple:!1,property:"twitter:site",fieldName:"twitterSite"},{multiple:!1,property:"twitter:site:id",fieldName:"twitterSiteId"},{multiple:!1,property:"twitter:creator",fieldName:"twitterCreator"},{multiple:!1,property:"twitter:creator:id",fieldName:"twitterCreatorId"},{multiple:!1,property:"twitter:title",fieldName:"twitterTitle"},{multiple:!1,property:"twitter:description",fieldName:"twitterDescription"},{multiple:!0,property:"twitter:image",fieldName:"twitterImage"},{multiple:!0,property:"twitter:image:height",fieldName:"twitterImageHeight"},{multiple:!0,property:"twitter:image:width",fieldName:"twitterImageWidth"},{multiple:!0,property:"twitter:image:src",fieldName:"twitterImageSrc"},{multiple:!0,property:"twitter:image:alt",fieldName:"twitterImageAlt"},{multiple:!0,property:"twitter:player",fieldName:"twitterPlayer"},{multiple:!0,property:"twitter:player:width",fieldName:"twitterPlayerWidth"},{multiple:!0,property:"twitter:player:height",fieldName:"twitterPlayerHeight"},{multiple:!0,property:"twitter:player:stream",fieldName:"twitterPlayerStream"},{multiple:!1,property:"twitter:app:name:iphone",fieldName:"twitterAppNameiPhone"},{multiple:!1,property:"twitter:app:id:iphone",fieldName:"twitterAppIdiPhone"},{multiple:!1,property:"twitter:app:url:iphone",fieldName:"twitterAppUrliPhone"},{multiple:!1,property:"twitter:app:name:ipad",fieldName:"twitterAppNameiPad"},{multiple:!1,property:"twitter:app:id:ipad",fieldName:"twitterAppIdiPad"},{multiple:!1,property:"twitter:app:url:ipad",fieldName:"twitterAppUrliPad"},{multiple:!1,property:"twitter:app:name:googleplay",fieldName:"twitterAppNameGooglePlay"},{multiple:!1,property:"twitter:app:id:googleplay",fieldName:"twitterAppIdGooglePlay"},{multiple:!1,property:"twitter:app:url:googleplay",fieldName:"twitterAppUrlGooglePlay"}];var L=function(e){return{url:e[0],width:e[1],height:e[2],alt:e[3]}},T=function(e){return{url:e[0],width:e[1],height:e[2],stream:e[3]}},$=function(e){return{url:e[0],width:e[1],height:e[2],type:e[3],duration:(t=e[4],isNaN(t)||(t=t%1==0?parseInt(t,10):parseFloat(t)),t)};var t},U=function(e,t){if(!e.url||!t.url)return 0;var r=e.url.match(/\.(\w{2,5})$/),i=r&&r[1].toLowerCase()||null,o=t.url.match(/\.(\w{2,5})$/),a=o&&o[1].toLowerCase()||null;return"gif"===i&&"gif"!==a?-1:"gif"!==i&&"gif"===a?1:Math.max(t.width,t.height)-Math.max(e.width,e.height)};const E=new Set(["application/x-shockwave-flash"]),R=new Set(["www.netflix.com"]);function D(e,t){const r=function(e,t){const r=void 0===t.ogImageFallback||t.ogImageFallback;let i=Object(A.load)(e),o=i("meta"),a=Object.keys(o),l={};a.forEach(function(e){if(o[e].attribs&&(o[e].attribs.property||o[e].attribs.name)){var t=o[e].attribs.property||o[e].attribs.name,r=o[e].attribs.content;H.forEach(function(e){t===e.property&&(e.multiple?l[e.fieldName]?Array.isArray(l[e.fieldName])&&l[e.fieldName].push(r):l[e.fieldName]=[r]:l[e.fieldName]=r)})}}),l.ogImage=l.ogImageSecureURL?l.ogImageSecureURL:l.ogImage?l.ogImage:l.ogImageURL?l.ogImageURL:[],l.ogImage&&l.ogImage.length||delete l.ogImage,(l.ogImage||l.ogImageWidth||l.twitterImageHeight||l.ogImageType)&&(l.ogImage=l.ogImage?l.ogImage:[null],l.ogImageWidth=l.ogImageWidth?l.ogImageWidth:[null],l.ogImageHeight=l.ogImageHeight?l.ogImageHeight:[null],l.ogImageType=l.ogImageType?l.ogImageType:[null]);var n=Object(q.a)(l.ogImage,l.ogImageWidth,l.ogImageHeight,l.ogImageType).map($).sort(U);(l.ogVideo||l.ogVideoWidth||l.ogVideoHeight||l.ogVideoType||l.ogVideoDuration)&&(l.ogVideo=l.ogVideo?l.ogVideo:[null],l.ogVideo=l.ogVideoSecureURL?l.ogVideoSecureURL:l.ogVideo,l.ogVideoWidth=l.ogVideoWidth?l.ogVideoWidth:[null],l.ogVideoHeight=l.ogVideoHeight?l.ogVideoHeight:[null],l.ogVideoType=l.ogVideoType?l.ogVideoType:[null],l.ogVideoDuration=l.videoDuration||l.ogVideoDuration||[null]);var s=Object(q.a)(l.ogVideo,l.ogVideoWidth,l.ogVideoHeight,l.ogVideoType,l.ogVideoDuration).map($).sort(U);(l.twitterImageSrc||l.twitterImage||l.twitterImageWidth||l.twitterImageHeight||l.twitterImageAlt)&&(l.twitterImage=l.twitterImage?l.twitterImage:l.twitterImageSrc,l.twitterImage=l.twitterImage?l.twitterImage:[null],l.twitterImageWidth=l.twitterImageWidth?l.twitterImageWidth:[null],l.twitterImageHeight=l.twitterImageHeight?l.twitterImageHeight:[null],l.twitterImageAlt=l.twitterImageAlt?l.twitterImageAlt:[null]);var p=Object(q.a)(l.twitterImage,l.twitterImageWidth,l.twitterImageHeight,l.twitterImageAlt).map(L).sort(U);(l.twitterPlayer||l.twitterPlayerWidth||l.twitterPlayerHeight||l.twitterPlayerStream)&&(l.twitterPlayer=l.twitterPlayer?l.twitterPlayer:[null],l.twitterPlayerWidth=l.twitterPlayerWidth?l.twitterPlayerWidth:[null],l.twitterPlayerHeight=l.twitterPlayerHeight?l.twitterPlayerHeight:[null],l.twitterPlayerStream=l.twitterPlayerStream?l.twitterPlayerStream:[null]);var d=Object(q.a)(l.twitterPlayer,l.twitterPlayerWidth,l.twitterPlayerHeight,l.twitterPlayerStream).map(T).sort(U);if(H.filter(function(e){return e.multiple}).forEach(function(e){delete l[e.fieldName]}),n.length&&(t.allMedia?l.ogImage=n:l.ogImage=n[0]),s.length&&(t.allMedia?l.ogVideo=s:l.ogVideo=s[0]),p.length&&(t.allMedia?l.twitterImage=p:l.twitterImage=p[0]),d.length&&(t.allMedia?l.twitterPlayer=d:l.twitterPlayer=d[0]),!t.onlyGetOpenGraphInfo&&(!l.ogTitle&&i("head > title").text()&&i("head > title").text().length>0&&(l.ogTitle=i("head > title").text()),!l.ogDescription&&i('head > meta[name="description"]').attr("content")&&i('head > meta[name="description"]').attr("content").length>0&&(l.ogDescription=i('head > meta[name="description"]').attr("content")),!l.ogImage&&r)){var m=["jpg","jpeg","png"];i("img").each(function(e,t){if(i(t).attr("src")&&i(t).attr("src").length>0&&-1!==m.indexOf(i(t).attr("src").split(".").pop()))return l.ogImage={url:i(t).attr("src")},!1})}return l}(t,{});console.log("og",r);const{ogTitle:i,ogImage:o,ogDescription:a}=r,l=o?{0:o.url}:void 0,n={url:e.href,title:i,thumbnails:l,description:a};let s=!R.has(e.hostname);if(s&&r.ogVideo){const e=r.ogVideo.type;(s=!e||!E.has(e))&&(n.url=r.ogVideo.url||n.url),r.ogVideo.duration&&(n.duration=1e3*r.ogVideo.duration)}return n}var M={match:({protocol:e})=>"http:"===e||"https:"===e,async resolve(e,t){const{url:r}=e.req,{$:i,body:o}=e.state;if(i&&o){const t=D(r,o);Object(w.b)(e.res,t)}return t()}};const k=/\/wp-json\/oembed\/.*?\/embed/i;var _={match:({protocol:e})=>"http:"===e||"https:"===e,async resolve(e,t){if("boolean"==typeof e.state.oEmbed&&!e.state.oEmbed)return t();const{url:r}=e.req;let i;if(e.state.oEmbedJson)i=e.state.oEmbedJson;else if(e.state.$){const{$:t}=e.state,r=t("link[type='text/json+oembed'], link[type='application/json+oembed']").attr("href");r&&!k.test(r)&&(i=await async function(e){const[t]=await m(e,{headers:{"user-agent":u.d}});return t}(r))}if(i){console.info("oembed",i);const t={url:function(e){if("string"==typeof e.html){const t=e.html.startsWith("&lt;")?Object(A.load)(e.html)("body").text():e.html;let r=Object(A.load)(t)("iframe").attr("src");if(r)return r.startsWith("//")?`http:${r}`:r}}(i),description:i.description};Object(w.b)(e.res,t)}return t()}};const C=(e,t)=>{if(t[e])return t[e]="true",!0};var G={match:({protocol:e,host:t})=>!(t&&t.indexOf("redd.it")>-1)&&("http:"===e||"https:"===e),async resolve(e,t){const{url:r}=e.res;return!!r&&r.endsWith("mp4")||(e.res.url=(e=>{const t=Object(a.parse)(e,!0),{query:r}=t;return C("autoplay",r)||C("auto_play",r)||["autoplay","auto_play"].forEach(e=>{r[e]="true"}),t.search=Object(l.a)(r),Object(a.format)(t)})(r)),t()}},J=r(865);var F={match:({protocol:e})=>"http:"===e||"https:"===e,async resolve(e,t){const{url:r}=e.req,{$:i}=e.state;if(i){i("noscript").each(function(t,r){const i=e.state.$(r).text();if(-1===i.indexOf("schema.org"))return;const o=Object(A.load)(i)("meta[itemprop='duration']").attr("content");if(o){const t=1e3*Object(J.toSeconds)(Object(J.parse)(o));t&&!isNaN(t)&&(e.res.duration=t)}})}return t()}};var B={match(e){const{hostname:t=""}=e;return t.endsWith("imgur.com")},async resolve(e,t){const{$:r}=e.state;if(r){const i=r("title").text().trim(),o=r("link[rel=image_src]").attr("href");if(!i.endsWith("Album on Imgur")&&o)return await t(),e.res.url=o,e.res}return t()}};r.d(t,"resolveMediaUrl",function(){return K}),r.d(t,"resolveMediaPlaylist",function(){return Q});const Y=[y,V,j,W,S,N,B,M,_,F,G],X=e=>{return{req:{type:"item",url:e,user:null},res:{type:"item",url:e.href,state:{}},state:{}}},z=e=>{if(e.description){const t=e.description.trim();e.description=t||void 0}return Object(i.a)(e)},K=async e=>{const t=new URL(e);if(!t.href)return null;const r=X(t),i=o(Y),a=await i(r)||r.res;return console.debug("Resolved media",r),z(a)},Q=async e=>{const t=new URL(e.url);if(!t.href)return null;const r=X(t);r.req={...r.req,type:e.type,state:e.state},console.log("resolving playlist",r);const i=o(Y),a=await i(r)||r.res;return z(a)}},703:function(e,t){}}]);
//# sourceMappingURL=1.app.prod.js.map